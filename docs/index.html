<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<title>Excess Bits: Countdown Clock</title>
		<!-- AUTHOR: Kaigani - 2021 -->

		<!-- mobile viewport: -->
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta property="og:title" content="Excess Bits: Countdown Clock">
		<meta property="og:image" content="https://kaigani.github.io/art-excess-bits/img/promo.png">
		<meta property="og:description" content="Countdown to launch!">
		<meta property="og:url" content="https://kaigani.github.io/art-excess-bits/">
		<meta name="twitter:card" content="summary_large_image">

		<!-- ARTWORK CODE HERE -->
        <script src="drawToken_annotated.js"></script> 
		<script>

			const timeMachine = {
				hhmmss : 'xxxxxx',
				canvasList : []
			}

			const launchDate = new Date('Sun Mar 28 2021 10:00:00 GMT-0700')
	
            window.addEventListener('load', init, false)

            function runLoop(){
				update()
				setInterval(update,1000)
			}
			
			function init(){

				let el = document.getElementById('timeBlock')
				// hh
				timeMachine.canvasList.push(addCanvas(el))
				timeMachine.canvasList.push(addCanvas(el))
				let sep = addCanvas(el)
				drawToken(sep,2883585)
				// mm
				timeMachine.canvasList.push(addCanvas(el))
				timeMachine.canvasList.push(addCanvas(el))
				sep = addCanvas(el)
				drawToken(sep,2883585)
				// ss
				timeMachine.canvasList.push(addCanvas(el))
				timeMachine.canvasList.push(addCanvas(el))

				//update()
				runLoop()	
			}

			function addCanvas(el){
				let canvas = document.createElement('canvas')
				canvas.width = 128
				canvas.height = 128
				el.appendChild(canvas)
				return canvas
			}

			function update() {

				let countdown = (launchDate.getTime()-Date.now())/1000

				if(countdown < 0){
					window.location.href='app.html'
				}
				
				let hours = parseInt(countdown / 3600)
				let secondsLeft = parseInt(countdown - hours * 3600)
				let minutes = parseInt(secondsLeft / 60)
				let seconds = parseInt(secondsLeft - minutes * 60)

				let hhmmss = hours.toString().padStart(2,'0')+minutes.toString().padStart(2,'0')+seconds.toString().padStart(2,'0')
				//console.log(hhmmss)
                
				for(let i=0;i<6;i++){
					if(timeMachine.hhmmss[i] !== hhmmss[i]){
						drawDigit(timeMachine.canvasList[i],hhmmss[i])
					}
				}

				timeMachine.hhmmss = hhmmss	
                
            }

			// randomly draw a digit
			function drawDigit(canvas,digit){
				// SEED - to be generated by ARTBLOCKS -- 
                // random seed - needs minimum of 27 bits - 0xfffffff
				let seed = parseInt(Math.random()*0xffffffffffff)
				let colorSeed = seed & 0xfff // first 12 bits
				let segmentSeed = (seed & 0x7f000) >> 12 // next 7 bits, shifted 12 bits
				let rarity = ((seed >> 19) & 0xff) === 1 ? 5 : ((seed >> 19) & 0xf) === 1 ? 3 : 4 
				//console.log(`FROM ${seed}: ${colorSeed},${segmentSeed},${(seed >> 19) & 0xff}`)


				// TEST 7-SEGMENT GLYPHS

				const digits = {
					'0':0x77,
					'1':0x12,
					'2':0x5d,
					'3':0x6d,
					'4':0x2e,
					'5':0x6b,
					'6':0x7b,
					'7':0x25,
					'8':0x7f,
					'9':0x6f
				}
				//segmentSeed = 0x77 // 0
				//segmentSeed = 0x12 // 1
				//segmentSeed = 0x24 // 1
				//segmentSeed = 0x5d // 2
				//segmentSeed = 0x6d // 3
				//segmentSeed = 0x2e // 4
				//segmentSeed = 0x6b // 5 
				//segmentSeed = 0x7b // 6
				//segmentSeed = 0x25 // 7
				//segmentSeed = 0x7f // 8 
				//segmentSeed = 0x6f // 9

				segmentSeed = digits[digit]


				// RE-COMPOSE SEED
				let rarityValue = rarity === 5 ? 0x1 : rarity === 3 ? 0x11 : 0 // anything else
				seed = colorSeed + (segmentSeed << 12) + (rarityValue << 19)
				//console.log(`TO ${seed}: ${colorSeed},${segmentSeed},${rarityValue}\n`)

                // the token is rendered, given the canvas and the random seed 
				drawToken(canvas,seed)
			}
			
	
    		function BlockElasticScroll(event) {
        		event.preventDefault();
    		}
    	</script>
		
		<style type="text/css" media="screen">
		
			* {
			  box-sizing: border-box;
			}

			@font-face {
			    font-family: 'apple_ii';
			    src: url('PrintChar21.ttf');
			}
			
			body {
			  font-family: 'apple_ii';
			}
			
			/* Style the header */
			.header {
			  padding: 30px;
			  text-align: center;
			  font-size: 16px;
			}
			
			/* Container for flexboxes */
			.row {
			  display: -webkit-flex;
			  display: flex;
			}
			
			/* Create three unequal columns that sits next to each other */
			.column {
			  padding: 0px;
			}
			
			/* Left and right column */
			.column.side {
			   -webkit-flex: 1;
			   -ms-flex: 1;
			   flex: 1;
			}
			
			/* Middle column */
			.column.middle {
			  -webkit-flex: 2;
			  -ms-flex: 2;
			  flex: 2;
			  text-align: center;
			}

			
			/* Style the footer */
			.footer {
			  padding: 10px;
			  text-align: center;
			}

            #timeBlock {
                padding: 16px;
				background-color: #C4CDD5;
				width:fit-content;
            }
			canvas {
				margin: 8px
			}
			
			/* Responsive layout - makes the three columns stack on top of each other instead of next to each other */
			@media (max-width: 600px) {
			  .row {
				-webkit-flex-direction: column;
				flex-direction: column;
			  }
			}
			</style>
		
	</head>
	<body ontouchmove="BlockElasticScroll(event);">
		
		
		<div class="header">
		  <p>EXCESS BITS</p>
		  <p>coming soon</p>
		</div>
		
		<div class="row">
			<div class="column side"></div>
			<div id='timeBlock' class="column middle"></div>
			<div class="column side"></div>
		  </div>
		
		</body>
		</html>
</html>
		